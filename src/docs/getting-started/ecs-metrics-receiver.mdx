---
title: 'Getting started using AWS ECS container metrics receiver in AWS OpenTelemetry Collector'
description:
    The Amazon ECS container agent provides a method to retrieve various task metadata and Docker stats, which is
    referred to as the task metadata endpoint. AWS Container Observability team wrote a receiver in the OpenTelemetry
    Collector that scrapes this task metadata endpoint and collects resource (such as CPU, memory, network, and disk)
    usage metrics. Customers can enable awsecscontainermetrics receiver in their OpenTelemetry configuration file to
    collect specific task- and container-level metrics and send them to their desired destinations and monitoring solutions.
path: '/docs/getting-started/ecs-metrics-receiver'
---

import SectionSeparator from "components/MdxSectionSeparator/sectionSeparator.jsx"

The Amazon ECS container agent provides a method to retrieve various task metadata and
[Docker stats](https://docs.docker.com/engine/api/v1.30/#operation/ContainerStats), which is referred to as the task
metadata endpoint. AWS Container Observability team wrote a receiver in the OpenTelemetry Collector that scrapes this
task metadata endpoint and collects resource (such as CPU, memory, network, and disk) usage metrics.
Customers can enable `awsecscontainermetrics` receiver in their OpenTelemetry configuration file to collect
specific task- and container-level metrics and send them to their desired destinations and monitoring solutions.

<SectionSeparator />

## Enabling the AWS ECS Container Metrics Receiver

To enable the `awsecscontainermetrics` receiver, write the name under receiver section in the config file. By default,
the receiver will scrape the ECS task metadata endpoint every 20s and collect all the metrics. For the full list of metrics,
see the [Available Metrics Table](#available-metrics).

The following configuration will collect AWS ECS resource usage metrics by using `awsecscontainermetrics` receiver and
send them to CloudWatch by using `awsemf` exporter.

```yaml lineNumbers=true
receivers:
  awsecscontainermetrics:
exporters:
  awsemf:
      namespace: 'ECS/ContainerInsights/OpenTelemetry'
      log_group_name: '/ecs/opentelemetry/containermetrics'

service:
  pipelines:
      metrics:
          receivers: [awsecscontainermetrics]
          exporters: [awsemf]
```

<SectionSeparator />

## Set Collection Interval Metrics

Customers can configure `collection_interval` under `awsecscontainermetrics` receiver to scrape and gather metrics at a
specific interval. The following example configuration will collect metrics every 40 seconds.

```yaml lineNumbers=true
receivers:
  awsecscontainermetrics:
      collection_interval: 40s
exporters:
  awsemf:
      namespace: 'ECS/ContainerInsights/OpenTelemetry'
      log_group_name: '/ecs/opentelemetry/containermetrics'

service:
  pipelines:
      metrics:
          receivers: [awsecscontainermetrics]
          exporters: [awsemf]
```

<SectionSeparator />

## Collect specific metrics and update metric names

The previous configuration files collect all the metrics and send them to Amazon CloudWatch using default names.
However, we can use `filter` and `metrictransform` processors to send specific metrics and rename them respectively.

The following configuration will collect only the `ecs.task.memory.utilized` metric and rename it to `MemoryUtilized`
before sending to CloudWatch.

```yaml lineNumbers=true
receivers:
  awsecscontainermetrics:
exporters:
  awsemf:
      namespace: 'ECS/ContainerInsights/OpenTelemetry'
      log_group_name: '/opentelemetry/ecs/containerinsights/{cluster}/performance'
processors:
  filter:
    metrics:
      include:
        match_type: strict
        metric_names:
          - ecs.task.memory.utilized

  metricstransform:
    transforms:
      - metric_name: ecs.task.memory.utilized
        action: update
        new_name: MemoryUtilized

service:
  pipelines:
      metrics:
          receivers: [awsecscontainermetrics]
          processors: [filter, metricstransform]
          exporters: [awsemf]
```

<SectionSeparator />

## Container insights experience

The following example shows a full configuration to get similar experience as container insights. It uses `awsecscontainermetrics`
receiver to collect all the resource usage metrics from ECS task metadata endpoint. It applies `filter` processor to select
only 8 task-level metrics and update metrics names using `metricstransform` processor.  Finally, it sends the
metrics to CloudWatch using `awsemf` exporter under the `ECS/ContainerInsights/OpenTelemetry` namespace.

```yaml lineNumbers=true
receivers:
  awsecscontainermetrics:
exporters:
  awsemf:
      namespace: 'ECS/ContainerInsights/OpenTelemetry'
      log_group_name: '/opentelemetry/ecs/containerinsights/{cluster}/performance'
processors:
  filter:
    metrics:
      include:
        match_type: strict
        metric_names:
          - ecs.task.memory.utilized
          - ecs.task.memory.reserved
          - ecs.task.cpu.utilized
          - ecs.task.cpu.reserved
          - ecs.task.network.rate.rx
          - ecs.task.network.rate.tx
          - ecs.task.storage.read_bytes
          - ecs.task.storage.write_bytes
  metricstransform:
    transforms:
      - metric_name: ecs.task.memory.utilized
        action: update
        new_name: MemoryUtilized
      - metric_name: ecs.task.memory.reserved
        action: update
        new_name: MemoryReserved
      - metric_name: ecs.task.cpu.utilized
        action: update
        new_name: CpuUtilized
      - metric_name: ecs.task.cpu.reserved
        action: update
        new_name: CpuReserved
      - metric_name: ecs.task.network.rate.rx
        action: update
        new_name: NetworkRateRx
      - metric_name: ecs.task.network.rate.tx
        action: update
        new_name: NetworkRateTx
      - metric_name: ecs.task.storage.read_bytes
        action: update
        new_name: StorageRead
      - metric_name: ecs.task.storage.write_bytes
        action: update
        new_name: StorageWrite

service:
  pipelines:
      metrics:
          receivers: [awsecscontainermetrics]
          processors: [filter, metricstransform]
          exporters: [awsemf]
```

<SectionSeparator />

## Available Metrics


| Container Level Metrics                | Task Level Metrics                    |
| -------------------------------------- | ------------------------------------- |
| container.memory.usage                 | ecs.task.memory.usage                 |
| container.memory.usage.max             | ecs.task.memory.usage.max             |
| container.memory.usage.limit           | ecs.task.memory.usage.limit           |
| container.memory.reserved              | ecs.task.memory.reserved              |
| container.memory.utilized              | ecs.task.memory.utilized              |
|                                        |                                       |
|                                        |                                       |
| container.cpu.usage.total              | ecs.task.cpu.usage.total              |
| container.cpu.usage.kernelmode         | ecs.task.cpu.usage.kernelmode         |
| container.cpu.usage.usermode           | ecs.task.cpu.usage.usermode           |
| container.cpu.cores                    | ecs.task.cpu.cores                    |
| container.cpu.onlines                  | ecs.task.cpu.onlines                  |
| container.cpu.usage.system             | ecs.task.cpu.usage.system             |
| container.cpu.reserved                 | ecs.task.cpu.reserved                 |
| container.cpu.utilized                 | ecs.task.cpu.utilized                 |
|                                        |                                       |
|                                        |                                       |
| container.network.rate.rx              | ecs.task.network.rate.rx              |
| container.network.rate.tx              | ecs.task.network.rate.tx              |
| container.network.io.usage.rx\_bytes   | ecs.task.network.io.usage.rx\_bytes   |
| container.network.io.usage.rx\_packets | ecs.task.network.io.usage.rx\_packets |
| container.network.io.usage.rx\_errors  | ecs.task.network.io.usage.rx\_errors  |
| container.network.io.usage.rx\_dropped | ecs.task.network.io.usage.rx\_dropped |
| container.network.io.usage.tx\_bytes   | ecs.task.network.io.usage.tx\_bytes   |
| container.network.io.usage.tx\_packets | ecs.task.network.io.usage.tx\_packets |
| container.network.io.usage.tx\_errors  | ecs.task.network.io.usage.tx\_errors  |
| container.network.io.usage.tx\_dropped | ecs.task.network.io.usage.tx\_dropped |
|                                        |                                       |
|                                        |                                       |
| container.storage.read\_bytes          | ecs.task.storage.read\_bytes          |
| container.storage.write\_bytes         | ecs.task.storage.write\_bytes         |